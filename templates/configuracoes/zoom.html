{% extends "base.html" %}

{% block title %}Configuração de Zoom - UECI{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row mb-4">
        <div class="col-12">
            <h2 class="mb-0">
                <i class="bi bi-zoom-in"></i> Configuração de Zoom
            </h2>
            <p class="text-muted">Ajuste o nível de zoom padrão do sistema</p>
        </div>
    </div>
    
    <div class="row">
        <div class="col-lg-6">
            <div class="card shadow">
                <div class="card-header bg-gradient" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <h5 class="mb-0"><i class="bi bi-sliders"></i> Ajustar Zoom</h5>
                </div>
                <div class="card-body">
                    <div class="mb-4">
                        <label for="zoomRange" class="form-label fw-bold">
                            Nível de Zoom: <span id="zoomValue">{{ zoom_atual }}%</span>
                        </label>
                        <input type="range" class="form-range" id="zoomRange" 
                               min="50" max="150" step="5" value="{{ zoom_atual }}">
                        <div class="d-flex justify-content-between">
                            <small class="text-muted">50%</small>
                            <small class="text-muted">100%</small>
                            <small class="text-muted">150%</small>
                        </div>
                    </div>
                    
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i>
                        <strong>Dica:</strong> O zoom afeta a visualização de todo o sistema. 
                        Valores menores mostram mais conteúdo, valores maiores facilitam a leitura.
                    </div>
                    
                    <div class="d-flex gap-2">
                        <button class="btn btn-primary" onclick="salvarZoom()">
                            <i class="bi bi-save"></i> Salvar Configuração
                        </button>
                        <button class="btn btn-secondary" onclick="aplicarZoomTemporario()">
                            <i class="bi bi-eye"></i> Visualizar (Temporário)
                        </button>
                        <button class="btn btn-outline-secondary" onclick="resetarZoom()">
                            <i class="bi bi-arrow-counterclockwise"></i> Resetar para 80%
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6">
            <div class="card shadow">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="bi bi-eye"></i> Pré-visualização</h5>
                </div>
                <div class="card-body" id="previewArea">
                    <h5>Exemplo de Texto</h5>
                    <p>Este é um exemplo de como o conteúdo aparecerá com o zoom atual.</p>
                    
                    <table class="table table-sm table-bordered">
                        <thead>
                            <tr class="table-primary">
                                <th>Campo 1</th>
                                <th>Campo 2</th>
                                <th>Campo 3</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Dado 1</td>
                                <td>Dado 2</td>
                                <td>Dado 3</td>
                            </tr>
                            <tr>
                                <td>Dado 4</td>
                                <td>Dado 5</td>
                                <td>Dado 6</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="alert alert-warning mb-0">
                        <i class="bi bi-exclamation-triangle"></i> Mensagem de exemplo
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
const zoomRange = document.getElementById('zoomRange');
const zoomValue = document.getElementById('zoomValue');
const previewArea = document.getElementById('previewArea');

// Atualizar display do valor
zoomRange.addEventListener('input', function() {
    zoomValue.textContent = this.value + '%';
    aplicarZoomPreview(this.value);
});

function aplicarZoomPreview(zoom) {
    previewArea.style.zoom = zoom + '%';
}

function aplicarZoomTemporario() {
    const zoom = zoomRange.value;
    document.body.style.zoom = zoom + '%';
    
    const toast = document.createElement('div');
    toast.className = 'position-fixed top-0 end-0 p-3';
    toast.style.zIndex = '9999';
    toast.innerHTML = `
        <div class="toast show" role="alert">
            <div class="toast-header bg-info text-white">
                <strong class="me-auto">Zoom Temporário</strong>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body">
                Zoom ${zoom}% aplicado temporariamente. Salve para tornar permanente.
            </div>
        </div>
    `;
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 3000);
}

function salvarZoom() {
    const zoom = zoomRange.value;
    
    fetch('{{ url_for("configuracoes.salvar_zoom") }}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: new URLSearchParams({
            'zoom': zoom
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Salvar no localStorage para acesso rápido
            localStorage.setItem('sistema_zoom', zoom);
            
            // Aplicar zoom
            document.body.style.zoom = zoom + '%';
            
            // Mostrar mensagem de sucesso
            const toast = document.createElement('div');
            toast.className = 'position-fixed top-0 end-0 p-3';
            toast.style.zIndex = '9999';
            toast.innerHTML = `
                <div class="toast show" role="alert">
                    <div class="toast-header bg-success text-white">
                        <strong class="me-auto">Sucesso</strong>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
                    </div>
                    <div class="toast-body">
                        ${data.message}<br>
                        <small>A página será recarregada em 2 segundos...</small>
                    </div>
                </div>
            `;
            document.body.appendChild(toast);
            
            // Recarregar página após 2 segundos
            setTimeout(() => {
                location.reload();
            }, 2000);
        } else {
            alert('Erro: ' + data.message);
        }
    })
    .catch(error => {
        alert('Erro ao salvar zoom: ' + error);
    });
}

function resetarZoom() {
    zoomRange.value = 80;
    zoomValue.textContent = '80%';
    aplicarZoomPreview(80);
}

// Aplicar zoom inicial no preview
aplicarZoomPreview({{ zoom_atual }});
</script>
{% endblock %}
